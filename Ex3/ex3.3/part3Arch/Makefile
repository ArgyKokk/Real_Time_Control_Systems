# Makefile for part3Arch.archm for Xenomai target platform
# Generated by the TERRA Arch2LUNA generator version 1.0.1
#
# protected region document description on begin
# protected region document description end

SOURCE_FILES=src/main.cpp src/MainModel.cpp

# Targets are expanded a second time, just before the rule is used
.SECONDEXPANSION:

# Contains the compiler commands that were used to build LUNA
-include /home/rtsd/RTSD/LUNA/luna-xenomai-arm-v7-Posix/lib/../tools.mk
ifneq ($(XENOMAI_BUILD),1)
  $(warning The generated code is for Xenomai, while tools.mk does not indicate that LUNA is build for Xenomai)
endif

# Additional commands
RM=rm -rf
MKDIR=mkdir -p

# Compiler/Linker flags
LDFLAGS+=-L/home/rtsd/RTSD/LUNA/luna-xenomai-arm-v7-Posix/lib
CPPFLAGS+=-Iinclude -I/home/rtsd/RTSD/LUNA/luna-xenomai-arm-v7-Posix/include
LIBS+=-lLUNA

# Add external model paths
CPPFLAGS+= -I ../EncoderHorizontal/include -I ../EncoderV/include -I ../JIWY/include -I ../ControllerPan/include -I ../ControllerTilt/include -I ../joystick/include -I ../PWM/include
LDFLAGS+= -L ../EncoderHorizontal/lib -L ../EncoderV/lib -L ../JIWY/lib -L ../ControllerPan/lib -L ../ControllerTilt/lib -L ../joystick/lib -L ../PWM/lib
LIBS:= -lEncoderHorizontal -lEncoderV -lJIWY -lControllerPan -lControllerTilt -ljoystick -lPWM $(LIBS) -lm



LIBS+=-lpthread


# Required by the Xenomai
# LDFLAGS+=-static-libstdc++ -static-libgcc

## protected region to add additional statements on begin
# For example, use this region to add additional files that are required:
#SOURCE_FILES+=xxsim/PID/PID.cpp $(wildcard xxsim/common/*.cpp)
#CPPFLAGS+=-Ixxsim/PID -Ixxsim/common 

LIBS:=$(subst -lm ,,$(LIBS))
LIBS:=$(subst -lpthread,,$(LIBS))

## protected region to add additional statements end

OBJECT_FILES=$(patsubst src/%.cpp,obj/%.o,$(SOURCE_FILES))

all: part3Arch

part3Arch: $(OBJECT_FILES)
	$(CXX) $(LDFLAGS) $^ $(LIBS) -o $@

obj/%.o: src/%.cpp | $$(@D)
	$(CXX) -c $(CPPFLAGS) -o $@ $<

clean:
	$(RM) obj lib part3Arch

# Targets for creating directories
uniq = $(strip $(if $1,$(firstword $1) $(call uniq,$(filter-out $(firstword $1),$1))))
DIRS:=$(call uniq,$(patsubst %/,%,lib/ $(dir $(OBJECT_FILES))))

define DirectoryTarget
  $(foreach directory, $(DIRS),
    $(directory):
	$(MKDIR) $(directory)
  )
endef
$(eval $(call DirectoryTarget))

# Dependencies
part3Arch: ../EncoderHorizontal/lib/libEncoderHorizontal.a
part3Arch: ../EncoderV/lib/libEncoderV.a
part3Arch: ../JIWY/lib/libJIWY.a
part3Arch: ../ControllerPan/lib/libControllerPan.a
part3Arch: ../ControllerTilt/lib/libControllerTilt.a
part3Arch: ../PWM/lib/libPWM.a
part3Arch: ../joystick/lib/libjoystick.a
obj/main.o: include/MainModel.h
obj/MainModel.o: include/MainModel.h ../EncoderHorizontal/include/EncoderHorizontal/EncoderHorizontal.h ../EncoderV/include/EncoderV/EncoderV.h ../JIWY/include/JIWY/JIWY.h ../ControllerPan/include/ControllerPan/ControllerPan.h ../ControllerTilt/include/ControllerTilt/ControllerTilt.h ../joystick/include/joystick/joystick.h ../PWM/include/PWM/PWM.h

# protected region additional targets on begin
part3Arch: $(OBJECT_FILES)
		$(CXX) -Wl,-Ur -nostdlib $(LDFLAGS) -Wl,@$(SYSROOT)/usr/xenomai/lib/cobalt.wrappers -Wl,@$(SYSROOT)/usr/xenomai/lib/modechk.wrappers $(SYSROOT)/usr/xenomai/lib/xenomai/bootstrap.o -L$(SYSROOT)/usr/xenomai/lib $^ $(RLDFLAGS) $(LIBS) -lramstix2 -o part3Arch.tmp
		$(CXX) part3Arch.tmp -Wl,--wrap=main -Wl,--dynamic-list=$(SYSROOT)/usr/xenomai/lib/dynlist.ld -L$(SYSROOT)/usr/xenomai/lib -lcobalt -lmodechk -lpthread -lrt -o $@
# protected region additional targets end